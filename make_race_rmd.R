
# Create Race results Rmd -------------------------------------------------


header <- paste0({
"# (PART) Race Results {#races}

<!-- Do not edit this file -->
<!-- This Rmd file is created using make_race_rmd.R -->

"
})


races <- foreach (i=rev(race_numbers), .combine = paste0 ) %do% {
  
  i_date_file <- format(dt_season[race_number == i]$date_ymd[1], "%Y-%m-%d")
  i_date <- format(dt_season[race_number == i]$date_ymd[1], "%b %d")
  
  i_race_type <- dt_season[race_number == i]$race_type[1]
  
  # Available course results - place club championship or double-distance first
  
  dt_season_i <- dt_season[race_number==i][order(-is_champ,course )]
  
  i_courses <- dt_season_i$course
  i_courses_nice <- dt_season_i$course_nice
  i_is_champ <- dt_season_i$is_champ
  
  j_options <- seq(length(i_courses))
  
  paste0(
    "
",
"# ", i,": ", i_date, ifelse(i_race_type=="Standard", "", paste0(" - ",i_race_type))," {#r-", i_date_file, "}
    
    ",
  foreach (j_counter=j_options, .combine = paste0 ) %do% {
    
    j <- i_courses[j_counter]
    j_is_champ <- i_is_champ[j_counter]
    
    dt_i <- dt_all_long[race_number== i & course == j & j_is_champ == (is_champ)][(started)]
    
    n_athletes <- length(unique(dt_i$Name))
    
    
paste0(
'
## ',i_courses_nice[j_counter],'


',

'```{r}
htmltools::tags$iframe(
  src = "',paste0(i_date_file,"_",j,ifelse(j_is_champ, "_champ",""),".html"),'", 
  scrolling = "no", 
  seamless = "seamless",
  frameBorder = "0",
  width = "100%",
  height = "',150 + 16*n_athletes,'"
)
```
    
    ',

# tables
  '

### Detailed results for ',i_courses_nice[j_counter],' course

Season records are show in gold, season PBs are shown in pink, and invalid times in grey. Ranks compare efforts in this race.

```{r}
htmltools::tags$iframe(
  src = "',paste0("tab_race_", i,"_",j,ifelse(j_is_champ, "_champ",""),".html"),'", 
  scrolling = "yes", 
  seamless = "seamless",
  frameBorder = "0",
  width = "100%",
  height = "',n_athletes*50+200,'"
)
```

'
)
  
    
  }
)
  
  
}

write(paste0(header, races),file = "02-races_generated.Rmd")
